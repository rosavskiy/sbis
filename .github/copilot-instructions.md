# Copilot Instructions for `sbis-edo-loader`

## Назначение репозитория
- CLI-инструмент на Node.js для частичной интеграции с ЭДО Saby (sbis).
- Функциональность: авторизация в Saby и **загрузка документов (doc) для отправки**, без фактической отправки контрагентам.

## Архитектура и ключевые файлы
- `package.json` — конфигурация Node.js-проекта, сборка через TypeScript (`tsconfig.json`).
- `src/sabyClient.ts` — обёртка над HTTP API Saby:
  - `SabyClient` выполняет авторизацию и метод загрузки черновика документа.
  - Не добавляй шаг отправки документа — только загрузка/подготовка.
- `src/loader.ts` — высокоуровневая функция `loadDocumentForEdo`:
  - читает локальный файл `doc`;
  - формирует имя файла;
  - вызывает `SabyClient.uploadDraftDocument` и возвращает служебную информацию (ID, путь).
- `src/cli.ts` — точка входа CLI:
  - парсит аргументы (путь к файлу, baseUrl, логин/пароль, meta JSON);
  - создаёт `SabyClient` и вызывает `loadDocumentForEdo`;
  - выводит результат в stdout в формате JSON.

## Особенности интеграции с Saby
- Основной сценарий: использовать последовательность API `auth` + `send_doc` только до шага **загрузки/подготовки** документа.
- В `SabyClient.uploadDraftDocument`:
  - опирайся на фактическую структуру методов `send_doc` из документации Saby;
  - отправляй файл как требует дока (часто base64 или multipart), структура сейчас условная;
  - **не добавляй** флаги/методы, переводящие документ в статус «отправлен».
- Все новые методы клиента должны быть идемпотентны по возможности и работать через уже существующий механизм авторизации.

## Конвенции и паттерны кода
- Язык: TypeScript, `module` = `ES2020`, `type` = `module` в `package.json`.
- Импорты — ES-модули с явным `.js` в путях внутри `src` при компиляции.
- Ошибки: бросай `Error` с понятным сообщением; не добавляй собственную иерархию ошибок без необходимости.
- Логирование в CLI — через `console.log` / `console.error`; библиотеку логов не подключать без явной потребности.

## Сборка и запуск (ожидаемый сценарий)
- Установка зависимостей:
  - `npm install`
- Сборка TypeScript:
  - `npm run build`
- Запуск CLI (пример, PowerShell):
  - `node dist/cli.js --file "C:\path\to\doc.doc" --baseUrl "https://online.sbis.ru/service" --login "user" --password "pass" --meta '{"docType":"contract"}'`

## Правила для агентов
- Перед изменениями изучай текущую реализацию `SabyClient` и `loader` и следуй уже заданным паттернам.
- Не добавляй функциональность отправки документов контрагентам, если это не запрошено явно.
- При расширении API (новые поля meta, новые типы документов) сначала ищи описание полей в документации Saby и отражай их в типах TypeScript.
- Изменения должны быть минимальными и локальными к задаче: не устраивай широкий рефакторинг без явного запроса.
- Всегда учитывай, что проект запускается в среде Windows PowerShell; команды в документации и README должны быть валидны для PowerShell.
