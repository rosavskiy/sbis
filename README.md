# sbis-edo-loader

CLI-инструмент на Node.js для частичной интеграции с ЭДО Saby (sbis):
загружает документы (doc) в систему Saby для последующей отправки, **но сам не отправляет их контрагентам**.

## Возможности
- Авторизация в Saby по логину и паролю.
- Загрузка документа как черновика/подготовленного документа через API `send_doc`.
- Вывод идентификаторов и служебной информации о загруженном документе в формате JSON.

## Требования
- Node.js 18+.
- Доступ к API Saby ЭДО (логин, пароль, базовый URL).

## Установка
```powershell
npm install
```

## Сборка
```powershell
npm run build
```

## Запуск
Пример команды в PowerShell:

```powershell
node dist/cli.js `
  --file "C:\path\to\document.doc" `
  --baseUrl "https://online.sbis.ru/service" `
  --login "your_login" `
  --password "your_password" `
  --meta '{"docType":"contract"}'
```

- Параметр `--meta` — произвольные метаданные документа в формате JSON.
- CLI **только загружает** документ в Saby, не отправляя его контрагентам.

## Тестовый UI
В репозитории есть простая форма (`npm run ui`), которая облегчает локальную проверку авторизации и загрузки:
- после успешной аутентификации UI подставляет `X-SBISSessionID` и реквизиты «нашей» организации;
- при загрузке документа не забудьте указать КПП для контрагентов-юрлиц (ИНН из 10 цифр). UI старается извлечь `КППxxxxxxxxx` из имени файла, но при необходимости поле можно заполнить вручную.
- во вкладке загрузки можно выбрать целую папку с `.doc`/`.docx` (используется `webkitdirectory`). Каждый файл отправляется отдельно; ИНН и КПП берутся из имени файла по шаблону `ИННxxxxxxxxxx` и `КППxxxxxxxxx`.

## Пакетная загрузка
CLI поддерживает массовую отправку документов из папки (один файл — один контрагент). Все файлы *.doc / *.docx будут обработаны последовательно с общими параметрами `baseUrl`, `login`, `password` и `meta`:

```powershell
node dist/cli.js `
  --dir "C:\reports\edo" `
  --baseUrl "https://online.sbis.ru/service" `
  --login "your_login" `
  --password "your_password" `
  --meta '{"docType":"contract"}'
```

Для одиночной загрузки продолжайте использовать `--file`.

## Замечания
- Формат тела запросов и точные URL методов Saby могут отличаться; текущая реализация — каркас.
- Перед использованием в продакшене сопоставьте структуру запросов и ответов с актуальной документацией Saby API `auth` и `send_doc`.
